var De=Object.defineProperty;var Oe=(i,e,t)=>e in i?De(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>(Oe(i,typeof e!="symbol"?e+"":e,t),t);import{u as q,h as C}from"./vendor.ba5edf09.js";const Te=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}};Te();function ae(i){return typeof i=="object"&&"x"in i&&"y"in i}class w{constructor(e,t){o(this,"x");o(this,"y");this.x=e,this.y=t!=null?t:e}static create(e){var t;return ae(e)?new w(e.x,e.y):Array.isArray(e)?new w(e[0],(t=e[1])!=null?t:e[0]):new w(e,e)}static fromOrigin(e){return new w(e.x,e.y)}get length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}diff(e){return new w(this.x/e,this.y/e)}toString(){return`|${this.x}, ${this.y}|`}}class f{constructor(e,t){o(this,"x");o(this,"y");this.x=e,this.y=t!=null?t:e}static get origin(){return new f(0,0)}static create(e){return ae(e)?new f(e.x,e.y):Array.isArray(e)?new f(e[0],e.length>1?e[1]:e[0]):new f(e,e)}static fromMouseEvent(e){return new f(e.offsetX,e.offsetY)}static fromTouchEvent(e){if(e.touches.length===0)throw new Error("empty touches");const t=e.target.getBoundingClientRect();return new f(e.touches[0].clientX-t.left,e.touches[0].clientY-t.top)}diff(e){return new w(e.x-this.x,e.y-this.y)}move(e){return this.translate(e.x,e.y)}translate(e,t){return new f(this.x+e,this.y+t)}isSame(e){return this.x===e.x&&this.y===e.y}toString(){return`(${this.x}, ${this.y})`}}const le=.1,Ae=.01,ze=10;class E{constructor(e,t=1){o(this,"origin");o(this,"scale");this.origin=e,this.scale=t}static initial(){return new E(f.origin,1)}static create(e){var t;return new E(f.create(e.origin),(t=e.scale)!=null?t:1)}zoomOut(){return this.scale<=Ae?this:new E(this.origin,this.scale-le)}zoomIn(){return this.scale>=ze?this:new E(this.origin,this.scale+le)}move(e){return new E(this.origin.move(e),this.scale)}applyTranspose(e){e.translate(this.origin.x,this.origin.y),e.scale(this.scale,this.scale)}toCoordinateSpace(e){return new f((e.x-this.origin.x)/this.scale,(e.y-this.origin.y)/this.scale)}}class y{constructor(e,t,n,r=1){o(this,"red");o(this,"green");o(this,"blue");o(this,"alpha");if(this.red=e,this.green=t,this.blue=n,this.alpha=r,e<0||e>1)throw new Error(`invalid red component: ${this.red}`);if(t<0||t>1)throw new Error(`invalid green component: ${this.green}`);if(n<0||n>1)throw new Error(`invalid blue component: ${this.blue}`);if(r<0||r>1)throw new Error(`invalid alpha component: ${this.alpha}`)}static fromRGBBytes(e,t,n,r=1){return new y(e/255,t/255,n/255,r)}static parseHex(e){if(e.charAt(0)!=="#")throw new Error(`Invalid color hex string: '${e}'`);let t=e.substring(1).split("");if(t.length===3&&(t=t.reduce((n,r)=>n.concat([r,r]),[])),t.length!==6)throw new Error(`Invalid color hex string: '${e}'`);return y.fromRGBBytes(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16))}lighten(e){return new y(Math.min(this.red+this.red*e,1),Math.min(this.green+this.green*e,1),Math.min(this.blue+this.blue*e,1),this.alpha)}darken(e){return new y(Math.max(this.red-this.red*e,0),Math.max(this.green-this.green*e,0),Math.max(this.blue-this.blue*e,0),this.alpha)}withAlpha(e){if(e<0||e>1)throw new Error(`invalid alpha component: ${this.alpha}`);return new y(this.red,this.green,this.blue,e)}toCSS(){return`rgba(${this.red*255}, ${this.green*255}, ${this.blue*255}, ${this.alpha})`}toHex(){return`#${G(this.red)}${G(this.green)}${G(this.blue)}`}toString(){return this.toCSS()}}function G(i){const e=(i*255).toString(16);return e.length<2?"0"+e:e}class v{constructor(e,t,n,r,s,a,l,p,c,m,g,b,u,h){o(this,"fillStyle");o(this,"strokeStyle");o(this,"lineWidth");o(this,"lineCap");o(this,"lineJoin");o(this,"shadowOffsetX");o(this,"shadowOffsetY");o(this,"shadowBlur");o(this,"shadowColor");o(this,"fontSize");o(this,"fontFamily");o(this,"textAlign");o(this,"direction");o(this,"lineDash");this.fillStyle=e,this.strokeStyle=t,this.lineWidth=n,this.lineCap=r,this.lineJoin=s,this.shadowOffsetX=l,this.shadowOffsetY=p,this.shadowBlur=c,this.shadowColor=m,this.fontSize=g,this.fontFamily=b,this.textAlign=u,this.direction=h,this.lineDash=typeof a=="number"?[a]:a}static create(e){var t,n,r,s,a,l,p,c,m,g,b,u,h,S;return e&&e instanceof v?e:new v((t=e==null?void 0:e.fillStyle)!=null?t:null,(n=e==null?void 0:e.strokeStyle)!=null?n:null,(r=e==null?void 0:e.lineWidth)!=null?r:null,(s=e==null?void 0:e.lineCap)!=null?s:null,(a=e==null?void 0:e.lineJoin)!=null?a:null,(l=e==null?void 0:e.lineDash)!=null?l:null,(p=e==null?void 0:e.shadowOffsetX)!=null?p:null,(c=e==null?void 0:e.shadowOffsetY)!=null?c:null,(m=e==null?void 0:e.shadowBlur)!=null?m:null,(g=e==null?void 0:e.shadowColor)!=null?g:null,(b=e==null?void 0:e.fontSize)!=null?b:null,(u=e==null?void 0:e.fontFamily)!=null?u:null,(h=e==null?void 0:e.textAlign)!=null?h:null,(S=e==null?void 0:e.direction)!=null?S:null)}prepare(e){var t,n;this.fillStyle!==null&&(e.fillStyle=ce(this.fillStyle)),this.strokeStyle!==null&&(e.strokeStyle=ce(this.strokeStyle)),this.lineWidth&&(e.lineWidth=this.lineWidth),this.lineDash!==null&&e.setLineDash(this.lineDash),this.lineCap&&(e.lineCap=this.lineCap),this.lineJoin&&(e.lineJoin=this.lineJoin),this.shadowOffsetX&&(e.shadowOffsetX=this.shadowOffsetX),this.shadowOffsetY&&(e.shadowOffsetY=this.shadowOffsetY),this.shadowBlur&&(e.shadowBlur=this.shadowBlur),this.shadowColor&&(e.shadowColor=this.shadowColor.toString()),(this.fontFamily||this.fontSize)&&(e.font=`${(t=this.fontSize)!=null?t:10}px ${(n=this.fontFamily)!=null?n:"sans-serif"}`),this.textAlign&&(e.textAlign=this.textAlign),this.direction&&(e.direction=this.direction)}apply(e){this.fillStyle&&e.fill(),this.strokeStyle&&e.stroke()}}function ce(i){return i instanceof y?i.toCSS():i}class M{constructor(e,t,n){o(this,"path");o(this,"closed");o(this,"style");this.path=e,this.closed=t,this.style=n}static rectangle(e){const t=w.create(e.size),n={d:[0,[0,t.y],[t.x,t.y],[t.x,0]],closed:!0,style:e.style};return this.create(n)}static ellipse(e){var s,a,l;const t=w.create(e.size),n=new Path2D;n.ellipse(t.x/2,t.y/2,t.x/2,t.y/2,(s=e.rotation)!=null?s:0,(a=e.startAngle)!=null?a:0,(l=e.endAngle)!=null?l:2*Math.PI);const r={d:n,closed:!0,style:e.style};return this.create(r)}static create(e){var n;let t;if(Array.isArray(e.d)){t=new Path2D;const r=e.d.map(f.create);t.moveTo(r[0].x,r[0].y),r.slice(1).forEach(s=>{t.lineTo(s.x,s.y)}),e.closed&&t.closePath()}else typeof e.d=="string"?t=new Path2D(e.d):t=e.d;return new M(t,(n=e.closed)!=null?n:!1,v.create(e.style))}repaint(e){this.style.prepare(e),this.style.fillStyle&&e.fill(this.path),this.style.strokeStyle&&e.stroke(this.path)}}class X{constructor(e,t){o(this,"text");o(this,"style");this.text=e,this.style=t}static create(e){var t,n,r;return e.style=Object.assign({},(t=e.style)!=null?t:{}),e.style.fillStyle=(r=(n=e.style.fillStyle)!=null?n:e.style.strokeStyle)!=null?r:"black",new X(e.text,v.create(e.style))}repaint(e){this.style.prepare(e),this.style.fillStyle?e.fillText(this.text,0,0):e.strokeText(this.text,0,0)}}class D{constructor(e,t){o(this,"at");o(this,"p");this.at=e,this.p=t}static create(e){return e instanceof D?e:Array.isArray(e)?new D(f.create(e[0]),e[1]):new D(f.origin,e)}repaint(e){try{e.save(),e.translate(this.at.x,this.at.y),this.p.repaint(e)}finally{e.restore()}}}class O{constructor(e,t,n,r,s,a,l){o(this,"id");o(this,"at");o(this,"selectable");o(this,"movable");o(this,"selected");o(this,"outline");o(this,"paintables");this.id=e,this.at=t,this.selectable=n,this.movable=r,this.selected=s,this.outline=a,this.paintables=l}static create(e){var t,n,r;return Array.isArray(e.paintables)||(e.paintables=[e.paintables]),new O((t=e.id)!=null?t:P(),f.create(e.at),!!e.outline,(n=e.movable)!=null?n:!1,!1,(r=e.outline)!=null?r:null,e.paintables.map(D.create))}repaint(e,t){try{e.save(),e.translate(this.at.x,this.at.y),this.paintables.forEach(n=>n.repaint(e)),this.selected&&this.outline&&(t.prepare(e),e.stroke(this.outline))}finally{e.restore()}}contains(e,t){if(!this.outline)return!1;const n=t.translate(-this.at.x,-this.at.y);return e.isPointInPath(this.outline,n.x,n.y)}}class j{constructor(e,...t){o(this,"id");o(this,"elements");this.id=e,this.elements=t}repaint(e,t){this.elements.forEach(n=>{n.repaint(e,t)})}firstHit(e,t){for(let n=this.elements.length-1;n>=0;n--)if(this.elements[n].selectable&&this.elements[n].contains(e,t))return this.elements[n];return null}get selected(){return this.elements.filter(e=>e.selected)}unselectAll(){this.elements.forEach(e=>e.selected=!1)}findElement(e){var t;return(t=this.elements.find(n=>n.id===e))!=null?t:null}}class Ie{constructor(...e){o(this,"layers");this.layers=e}findElement(e){for(const t of this.layers){const n=t.findElement(e);if(n!==null)return n}return null}findLayer(e){var t;return(t=this.layers.find(n=>n.id===e))!=null?t:null}repaint(e,t){this.layers.forEach(n=>n.repaint(e,t))}firstHit(e,t){for(let n=this.layers.length-1;n>=0;n--){const r=this.layers[n].firstHit(e,t);if(r!==null)return r}return null}get selected(){return this.layers.reduce((e,t)=>e.concat(t.selected),[])}unselectAll(){this.layers.forEach(e=>e.unselectAll())}}const he="abcdefghijklmnopqrstuvwxyz_-$",Le=16;function P(){let i="";for(let e=0;e<Le;++e)i+=he.charAt(Math.random()*he.length);return i}class Pe{constructor(){o(this,"listener",new Map)}on(e,t){var n;return this.listener.has(e)?((n=this.listener.get(e))==null||n.push(t),this):(this.listener.set(e,[t]),this)}emit(e,t){var n;return(n=this.listener.get(e))==null||n.forEach(r=>r(t)),this}}class N{constructor(e,t,n,r,s,a,l,p,c,m,g,b,u){o(this,"canvas");o(this,"_scene");o(this,"resize");o(this,"zoom");o(this,"select");o(this,"move");o(this,"drawingMode");o(this,"selectionStyle");o(this,"drawingStyle");o(this,"_grid");o(this,"_gridStyle");o(this,"_viewport");o(this,"_backgroundStyle",v.create({fillStyle:y.fromRGBBytes(200,200,200)}));o(this,"_gridSize");o(this,"eventEmitter",new Pe);o(this,"drawingPath",null);o(this,"drawnPoints",null);o(this,"onResize",()=>{!this.resize||this.repaint()});o(this,"interactOrigin",null);o(this,"interactLastCheckpoint",null);o(this,"onPointerDown",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.canvas.setPointerCapture(e.pointerId),this.onInteractStart(f.fromMouseEvent(e))});o(this,"onPointerUp",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.onInteractEnd(f.fromMouseEvent(e),e.ctrlKey)});o(this,"onInteractEnd",(e,t)=>{var n;if(this.interactOrigin!==null)try{if(this.drawingMode!==null){this.finishDraw(e);return}if(this.select){if((n=this.interactOrigin)==null?void 0:n.isSame(e)){this.handleSelection(e,t);return}if(this.scene.selected.length>0){this.emit({eventName:"sceneUpdated",source:this});return}}this.move&&!this.interactOrigin.isSame(e)&&this.emit({eventName:"viewportChanged",source:this})}finally{this.interactLastCheckpoint=null,this.interactOrigin=null}});o(this,"onPointerMove",e=>{!this.interactLastCheckpoint||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.canvas.setPointerCapture(e.pointerId),this.onInteractMove(f.fromMouseEvent(e)))});o(this,"onInteractMove",e=>{const t=this.interactLastCheckpoint.diff(e);if(this.interactLastCheckpoint=e,this.drawingMode!==null){this.handleDraw(e);return}if(!this.move)return;const n=this.scene.selected;if(n.length>0){n.forEach(r=>r.at=r.at.move(t.diff(this.viewport.scale))),this.repaint();return}this.viewport=this.viewport.move(t),this.repaint()});o(this,"onZoom",e=>{!this.zoom||this.drawingMode!==null||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.deltaY>0?this.viewport=this.viewport.zoomOut():this.viewport=this.viewport.zoomIn(),this.emit({eventName:"viewportChanged",source:this}),this.repaint())});this.canvas=e,this._scene=t,this.resize=n,this.zoom=r,this.select=s,this.move=a,this.drawingMode=l,this.selectionStyle=p,this.drawingStyle=c,this._grid=m,this._gridStyle=b,this._viewport=u!=null?u:E.initial(),this._gridSize=w.create(g)}static forCanvas(e){var t;return(t=de(e)._scenic)!=null?t:null}static create(e){var r,s,a,l,p,c,m,g,b,u;const t=de(e.canvas),n=new N(t,e.scene,(r=e.resize)!=null?r:!1,(s=e.zoom)!=null?s:!1,(a=e.select)!=null?a:!1,(l=e.move)!=null?l:!1,(p=e.drawingMode)!=null?p:null,v.create((c=e.selectionStyle)!=null?c:{strokeStyle:"#0069dba0",lineWidth:2,shadowColor:"#0083ff",shadowBlur:5}),v.create((m=e.drawingStyle)!=null?m:{strokeStyle:"#0069dba0",lineWidth:2,lineDash:[15,5],shadowColor:"#0083ff",shadowBlur:5}),(g=e.grid)!=null?g:!1,(b=e.gridSize)!=null?b:10,v.create((u=e.gridStyle)!=null?u:{strokeStyle:y.fromRGBBytes(150,150,150),lineWidth:1}),e.viewport);return t._scenic&&t._scenic.disconnect(),t._scenic=n,n.connect(),n.repaint(),n}get viewport(){return this._viewport}set viewport(e){this._viewport=e,this.repaint()}get scene(){return this._scene}set scene(e){this._scene=e,this.repaint()}get backgroundStyle(){return this._backgroundStyle}set backgroundStyle(e){this._backgroundStyle=e,this.repaint()}get grid(){return this._grid}set grid(e){this._grid=e,this.repaint()}get gridSize(){return this._gridSize}set gridSize(e){this._gridSize=w.create(e),this.repaint()}get gridStyle(){return this._gridStyle}set gridStyle(e){this._gridStyle=e,this.repaint()}on(e,t){return this.eventEmitter.on(e,t),this}repaint(){requestAnimationFrame(()=>{this.canvas.width=this.canvas.scrollWidth,this.canvas.height=this.canvas.scrollHeight;const e=this.canvas.getContext("2d");if(e.clearRect(0,0,this.canvas.width,this.canvas.height),this._backgroundStyle.prepare(e),e.fillRect(0,0,this.canvas.width,this.canvas.height),this.grid)try{e.save(),this._gridStyle.prepare(e);let t=this._viewport.origin.x%(this._gridSize.x*this._viewport.scale);for(;t<this.canvas.width;)t>0&&(e.moveTo(t,0),e.lineTo(t,this.canvas.height),e.stroke()),t+=this._gridSize.x*this._viewport.scale;let n=this._viewport.origin.y%(this._gridSize.y*this._viewport.scale);for(;n<this.canvas.width;)n>0&&(e.moveTo(0,n),e.lineTo(this.canvas.width,n),e.stroke()),n+=this._gridSize.y*this._viewport.scale}finally{e.restore()}try{e.save(),this.viewport.applyTranspose(e),this.scene.repaint(e,this.selectionStyle)}finally{e.restore()}if(this.drawingPath!==null)try{e.save(),this.drawingStyle.prepare(e),this.drawingStyle.fillStyle&&e.fill(this.drawingPath),this.drawingStyle.strokeStyle&&e.stroke(this.drawingPath)}finally{e.restore()}})}emit(e){this.eventEmitter.emit(e.eventName,e)}connect(){window.addEventListener("resize",this.onResize),this.canvas.addEventListener("wheel",this.onZoom),this.canvas.addEventListener("pointerdown",this.onPointerDown),this.canvas.addEventListener("pointerup",this.onPointerUp),this.canvas.addEventListener("pointermove",this.onPointerMove)}disconnect(){window.removeEventListener("resize",this.onResize),this.canvas.removeEventListener("wheel",this.onZoom),this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.canvas.removeEventListener("pointerup",this.onPointerUp),this.canvas.removeEventListener("pointermove",this.onPointerMove)}onInteractStart(e){this.interactOrigin=e,this.interactLastCheckpoint=this.interactOrigin}handleDraw(e){this.updateDrawingPath(e),this.repaint()}finishDraw(e){this.drawnPoints.push(this.viewport.toCoordinateSpace(e)),this.emit({eventName:"drawingFinished",source:this,mode:this.drawingMode,points:this.drawnPoints}),this.repaint(),this.drawingPath=null,this.drawnPoints=null}updateDrawingPath(e){if(this.drawingMode==="rect"){const t=this.interactOrigin.diff(e);this.drawingPath=new Path2D,this.drawingPath.rect(this.interactOrigin.x,this.interactOrigin.y,t.x,t.y),this.drawnPoints===null&&(this.drawnPoints=[this.viewport.toCoordinateSpace(e)])}else this.drawingMode==="line"&&(this.drawingPath===null?(this.drawingPath=new Path2D,this.drawingPath.moveTo(this.interactOrigin.x,this.interactOrigin.y),this.drawnPoints=[this.viewport.toCoordinateSpace(e)]):this.drawnPoints.push(this.viewport.toCoordinateSpace(e)),this.drawingPath.lineTo(e.x,e.y))}handleSelection(e,t){e=this.viewport.toCoordinateSpace(e);const n=this.canvas.getContext("2d"),r=this.scene.firstHit(n,e);r===null?this.scene.unselectAll():(t||this.scene.unselectAll(),r.selected=!r.selected),this.repaint(),this.emit({eventName:"selectionChanged",source:this})}}function de(i){if(typeof i!="string")return i;const e=document.querySelector(i);if(e===null)throw new Error(`No such canvas element: ${i}`);if(!(e instanceof HTMLCanvasElement))throw new Error(`Not a canvas element: ${e}`);return e}function Be(i,e){Fe(i).forEach(t=>{var n,r;t.at=(r=(n=e.findElement(t.id))==null?void 0:n.at)!=null?r:t.at})}function _e(i,...e){e.forEach(t=>{var r,s,a,l,p,c,m,g,b;let n=(s=(r=i.background)==null?void 0:r.findIndex(u=>u.id===t))!=null?s:-1;if(n>=0){(a=i.background)==null||a.splice(n,1);return}if(n=(p=(l=i.explanations)==null?void 0:l.findIndex(u=>u.id===t))!=null?p:-1,n>=0){(c=i.explanations)==null||c.splice(n,1);return}n=(g=(m=i.tokens)==null?void 0:m.findIndex(u=>u.id===t))!=null?g:-1,n>=0&&((b=i.tokens)==null||b.splice(n,1))})}function Fe(i){var t,n,r;let e=(t=i.background)!=null?t:[];return e=e.concat((n=i.explanations)!=null?n:[]),e=e.concat((r=i.tokens)!=null?r:[]),e}function B(i){var e,t,n,r,s,a;return new Ie(new j("background",...(t=(e=i.background)==null?void 0:e.map(l=>l.createSceneElement()))!=null?t:[]),new j("explanations",...(r=(n=i.explanations)==null?void 0:n.map(l=>l.createSceneElement()))!=null?r:[]),new j("tokens",...(a=(s=i.tokens)==null?void 0:s.map(l=>l.createSceneElement()))!=null?a:[]))}const x="battlemapUpdated",ue="viewportchanged",fe=y.fromRGBBytes(10,10,10),_={strokeStyle:fe,lineJoin:"round",lineWidth:5,shadowColor:fe,shadowBlur:5},We=y.fromRGBBytes(2,132,199),Y={strokeStyle:We,lineWidth:5,lineJoin:"round",lineDash:[15,5],fontFamily:"verdana, helvetica, arial, sans-serif",fontSize:20},J=y.parseHex("#b91c1c"),Ue={lineWidth:5,shadowColor:"#666",shadowBlur:5,shadowOffsetX:5,shadowOffsetY:5};function Re(i){let e;return typeof i=="string"?e=y.parseHex(i):e=i,He({strokeStyle:e,fillStyle:e.lighten(.5).withAlpha(.5)},Ue)}function He(i,e){return Object.assign({},i,e)}const T=50;class A{constructor(e,t,n,r){o(this,"id");o(this,"at");o(this,"points");o(this,"style");this.id=e,this.at=t,this.points=n,this.style=r}static create(e){var t,n;return new A((t=e.id)!=null?t:P(),f.create(e.at),e.points.map(f.create),(n=e.style)!=null?n:_)}createSceneElement(){let e=0,t=0,n=0,r=0;this.points.forEach(a=>{a.x<e&&(e=a.x),a.x>t&&(t=a.x),a.y<n&&(n=a.y),a.y>r&&(r=a.y)});const s=new Path2D;return s.rect(e-10,n-10,t-e+20,r-n+20),O.create({id:this.id,at:this.at,outline:s,paintables:M.create({d:this.points,style:_})})}}class z{constructor(e,t,n,r,s){o(this,"id");o(this,"at");o(this,"size");o(this,"label");o(this,"style");this.id=e,this.at=t,this.size=n,this.label=r,this.style=s}static create(e){var t,n,r;return new z((t=e.id)!=null?t:P(),f.create(e.at),w.create(e.size),(n=e.label)!=null?n:"Zone",(r=e.style)!=null?r:Y)}createSceneElement(){const e=new Path2D;return e.rect(-10,-10,this.size.x+20,this.size.y+20),O.create({id:this.id,at:this.at,outline:e,paintables:[M.rectangle({size:this.size,closed:!0,style:this.style}),[[10,25],X.create({text:this.label,style:this.style})]]})}}class I{constructor(e,t,n,r){o(this,"id");o(this,"at");o(this,"style");o(this,"color");this.id=e,this.at=t,this.style=n,this.color=r}static create(e){var n,r;let t=J;return e.color&&(typeof e.color=="string"?t=y.parseHex(e.color):t=e.color),new I((n=e.id)!=null?n:P(),f.create(e.at),(r=e.style)!=null?r:Re(t),t)}createSceneElement(){const e=new Path2D;return e.rect(-10,-10,T+10,T+10),O.create({id:this.id,at:this.at,outline:e,movable:!0,paintables:M.ellipse({size:T-10,closed:!0,style:this.style})})}}function pe(i,e){return typeof i!="string"?i:(e||(e=document.body),e.querySelector(i))}function F(i){Z(i.firstChild)}function Z(i,e){for(;i&&i!==e;){let t=i;i=i.nextSibling,t.parentNode.removeChild(t)}}function qe(i){return typeof i=="function"||Array.isArray(i)||i instanceof Element||me(i)}function W(i,e,t){t=t!=null?t:!0;const n=typeof i=="string"?pe(i):i;Ye(n,e),t&&Ge(n)}function Ge(i){if(!i.isConnected)return;let e=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,Xe),t;for(;t=e.nextNode();)t.dispatchEvent(new CustomEvent("update",{bubbles:!1}));for(e=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,je);t=e.nextNode();)t.dispatchEvent(new CustomEvent("update",{bubbles:!1}))}const Xe=i=>i.nodeType===Node.ELEMENT_NODE&&i.nodeName.indexOf("-")>=0?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT,je=i=>i.nodeType===Node.ELEMENT_NODE&&i.nodeName.indexOf("-")>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT;function Ye(i,e){if(Array.isArray(e)){F(i),e.forEach(t=>{const n=document.createDocumentFragment();W(n,t),i.appendChild(n)});return}if(typeof e=="string"){F(i),i.appendChild(document.createTextNode(e));return}if(e instanceof Element){F(i),i.appendChild(e);return}if(me(e)){e.updateElement(i);return}e(i)}function me(i){return typeof i=="object"&&"updateElement"in i}class ge extends HTMLElement{constructor(){super(...arguments);this.data={},this.connected=!1,this.renderContext=new Je(this),this.updateRequested=!1,this.executedOnceCallbackIds=new Set,this.requestUpdate=()=>{if(!this.updateRequested)return this.updateRequested=!0,setTimeout(this.executeUpdate.bind(this),1),this},this.emit=(e,t)=>{const n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!0});return this.dispatchEvent(n),this}}setData(e){return e&&Object.keys(e).forEach(t=>this.data[t]=e[t]),this.connected&&this.requestUpdate(),this}mount(e){return pe(e).appendChild(this),this}connectedCallback(){Array.prototype.forEach.call(this.attributes,e=>{this.observedAttributes.indexOf(e.name)!==-1&&(this.data[e.name]=e.value)}),this.connected=!0,this.updateDom()}disconnectedCallback(){this.childNodes.forEach(this.removeChild.bind(this)),this.connected=!1}attributeChangedCallback(e,t,n){const r={};r[Ze(e)]=n,this.setData(r)}registerOnceCallback(e,t){this.executedOnceCallbackIds.has(e)||(this.executedOnceCallbackIds.add(e),Promise.resolve().then(()=>{t()}))}executeUpdate(){!this.updateRequested||Promise.resolve().then(()=>{const e=this.observedAttributes;Object.keys(this.data).forEach(t=>{e.indexOf(t)>-1&&this.setAttribute(ye(t),this.data[t])}),this.updateDom()})}updateDom(){const e=this.renderCallback(this.data||{},this.renderContext);this.updateRequested=!1,W(this,e)}}class Je{constructor(e){this.component=e}requestUpdate(){return this.component.requestUpdate(),this}emit(e,t){return this.component.emit(e,t),this}addEventListener(e,t){return this.component.addEventListener(e,t),this}once(e,t){return this.component.registerOnceCallback(e,t),this}}function be(i,e,...t){const n=t.map(s=>Array.isArray(s)?s:[s]).reduce((s,a)=>s.concat(a),[]),r=n.map(s=>ye(s));return window.customElements.define(i,class extends ge{constructor(){super(...arguments);this.renderCallback=e,this.observedAttributes=n}static get observedAttributes(){return r}}),Ve.bind(null,i)}function ye(i){let e="",t=!1;for(let n of i)n.toUpperCase()===n?(t&&(e+="-"),e+=n.toLowerCase(),t=!0):(e+=n,t=!1);return e}function Ze(i){let e="",t=!1;for(let n of i)n==="-"?t=!0:t?(e+=n.toUpperCase(),t=!1):e+=n;return e}function Ve(i,e,t){const n=document.createElement(i);if(!(n instanceof ge)){console.error("Element is not a defined Weco element:",n);return}return n.setData(e),typeof t!="undefined"&&t!==null&&n.mount(t),n}function we(i){return e=>{const t=e.shadowRoot||e.attachShadow({mode:"open"});typeof i=="function"?i.call(null,t):W(t.getRootNode(),i,!0)}}const ve="{{wecco:",Ke="}}",Ee=/(\{\{wecco:\d+\}\})/;function Qe(i){return i.split(Ee).filter(e=>e.length>0)}function $(i){return!!i.match(Ee)}function L(i){return parseInt(i.substr(ve.length))}function xe(i){return ve+i.toString()+Ke}const V=new WeakMap;class K{constructor(e,t){this.strings=e,this.data=t}get templateString(){return typeof this._templateString=="undefined"&&([this._templateString,this._attributeMappings]=nt(this.strings)),this._templateString}get templateElement(){return typeof this._templateElement=="undefined"&&(this._templateElement=document.createElement("template"),this._templateElement.innerHTML=this.templateString,this._bindings=ct(this._templateElement.content,this)),this._templateElement}get bindings(){return typeof this._bindings=="undefined"?[]:this._bindings}updateElement(e){if(V.has(e)){const t=V.get(e);if(t.strings===this.strings){t.data=this.data,ie(t.bindings,this.data);return}}F(e),e.appendChild(this.templateElement.content.cloneNode(!0)),lt(this.bindings,e),ie(this.bindings,this.data),V.set(e,this)}attributeName(e){return this._attributeMappings.get(e)}}const et=/([.?@]?[a-z0-9-_@]+)\s*=\s*$/i,tt=/([.?@]?[a-z0-9-_@]+)\s*=\s*'[^']*$/i,it=/([.?@]?[a-z0-9-_@]+)\s*=\s*"[^"]*$/i;function nt(i){let e="";const t=new Map;return i.forEach((n,r)=>{if(e+=n,r<i.length-1){const s=et.exec(e)||tt.exec(e)||it.exec(e);if(s){const a=xe(r);e+=a,t.set(a,s[1])}else e+=`<!--${xe(r)}-->`}}),[e.trim(),t]}const U="DOM inconsistency error";class Q{constructor(e){this.nodeIndex=e}bind(e,t){t===this.nodeIndex&&this.bindNode(e)}bindNode(e){this.node=e}}class ee extends Q{constructor(e,t){super(e);this.dataIndex=t}applyData(e){const t=e[this.dataIndex];this.boundData!==t&&(this.applyChangedData(t),this.boundData=t)}}class te extends Q{constructor(e,t){super(e);this.dataIndex=t}bindNode(e){super.bindNode(e),e.data="",this.endMarker=e,this.startMarker=e.parentNode.insertBefore(Se(),e)}applyData(e){const t=e[this.dataIndex];this.boundData!==t&&(typeof t=="string"?this.applyText(t):ht(t)?this.applyIterable(t):qe(t)?this.applyElementUpdate(t):this.applyText(String(t)))}applyIterable(e){const t=Array.from(e);if(Array.isArray(this.boundData)){const n=this.boundData;t.length<n.length?(Z(n[t.length].startMarker,this.endMarker),this.boundData=n.slice(0,t.length)):t.length>n.length&&this.createBindingsFromIterable(t,n.length)}else this.clear(),this.boundData=[],this.createBindingsFromIterable(t);this.boundData.forEach(n=>n.applyData(t))}createBindingsFromIterable(e,t=0){for(let n=t;n<e.length;++n){const r=this.endMarker.parentNode.insertBefore(Se(),this.endMarker),s=new te(this.nodeIndex,n);s.bind(r,this.nodeIndex),this.boundData.push(s)}}applyElementUpdate(e){if(e instanceof K&&this.boundData instanceof K&&e.templateString===this.boundData.templateString){this.boundData.data=e.data,ie(this.boundData.bindings,e.data);return}this.clear();const t=document.createDocumentFragment();W(t,e,!1),this.endMarker.parentNode.insertBefore(t,this.endMarker),this.boundData=e}applyText(e){if(this.endMarker.previousSibling.nodeType===Node.TEXT_NODE){this.endMarker.previousSibling.data=e,this.boundData=e;return}this.clear(),this.node=this.endMarker.parentNode.insertBefore(document.createTextNode(e),this.endMarker),this.boundData=e}clear(){var e;const t=this.startMarker?this.startMarker.nextSibling:this.node.parentNode.firstChild;Z(t,(e=this.endMarker)!==null&&e!==void 0?e:this.node)}}class rt extends Q{constructor(e,t,n,r){super(e);this.attributeName=t,this.valueInstructions=n,this.directives=r}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.attributeName} but got ${e}`),U;this.element=e,super.bindNode(e)}applyData(e){let t=!1;const n=this.valueInstructions.map(r=>{if(typeof r=="string")return r;let s=e[r];return(typeof s=="undefined"||s===null)&&(t=!0),s}).join("");if(t&&this.directives.omitEmpty){this.element.removeAttribute(this.attributeName),this.boundAttributeValue=void 0;return}n!==this.boundAttributeValue&&(this.element.setAttribute(this.attributeName,n),this.boundAttributeValue=n)}}class st extends ee{constructor(e,t,n){super(e,n);this.attributeName=t}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.attributeName} but got ${e}`),U;this.element=e,super.bindNode(e)}applyChangedData(e){e?this.element.setAttribute(this.attributeName,this.attributeName):this.element.removeAttribute(this.attributeName)}}class ot extends ee{constructor(e,t,n,r){super(e,n);this.eventName=t,this.directives=r}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.eventName} but got ${e}`),U;this.element=e,super.bindNode(e)}applyChangedData(e){this.boundListener&&this.element.removeEventListener(this.eventName,this.boundListener),this.boundListener=this.createListener(e),this.element.addEventListener(this.eventName,this.boundListener,this.directives)}createListener(e){return!this.directives.stopPropagation&&!this.directives.stopImmediatePropagation&&!this.directives.preventDefault?e:t=>{this.directives.stopPropagation&&t.stopPropagation(),this.directives.stopImmediatePropagation&&t.stopImmediatePropagation(),this.directives.preventDefault&&t.preventDefault(),"handleEvent"in e?e.handleEvent(t):e(t)}}}class at extends ee{constructor(e,t,n){super(e,n);this.propertyName=t}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set property ${this.propertyName} but got ${e}`),U;this.element=e,super.bindNode(e)}applyChangedData(e){this.element[this.propertyName]=e}}function ie(i,e){i.forEach(t=>t.applyData(e))}function lt(i,e){const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null);let n=-1,r;for(;r=t.nextNode();)n++,i.forEach(s=>s.bind(r,n))}function ct(i,e){const t=[],n=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null);let r=-1,s;for(;s=n.nextNode();)if(r++,s.nodeType===Node.COMMENT_NODE){const a=s;$(a.data)&&t.push(new te(r,L(a.data)))}else if(s.nodeType===Node.ELEMENT_NODE){const a=s;for(let l of a.getAttributeNames()){const p=a.getAttribute(l),c=Qe(p);if(l.startsWith("?")){if(a.removeAttribute(l),c.length!==1||!$(c[0])){console.error(`Got syntax error using boolean attribute ${l}: Only single placeholder is allowed as value. Found at ${a}.`);continue}t.push(new st(r,l.substring(1),L(c[0])));continue}if(l.startsWith(".")){if(a.removeAttribute(l),c.length!==1||!$(c[0])){console.error(`Got syntax error using property ${l}: Only single placeholder is allowed as value. Found at ${a}.`);continue}const h=e.attributeName(c[0]);t.push(new at(r,h.substring(1),L(c[0])));continue}if(l.startsWith("@")){if(a.removeAttribute(l),c.length!==1||!$(c[0])){console.error(`Got syntax error using event listener ${l}: Only single placeholder is allowed as value. Found at ${a}.`);continue}const h={},[S,...d]=l.substring(1).split("+");d.forEach(k=>{switch(k.toLocaleLowerCase()){case"capture":h.capture=!0;break;case"passive":h.passive=!0;break;case"once":h.once=!0;break;case"stoppropagation":h.stopPropagation=!0;break;case"stopimmediatepropagation":h.stopImmediatePropagation=!0;break;case"preventdefault":h.preventDefault=!0;break;default:console.warn(`unrecognized event binding directive: "${k}"`)}}),t.push(new ot(r,S,L(c[0]),h));continue}if(c.length===1&&!$(c[0]))continue;a.removeAttribute(l);const m=c.map(h=>$(h)?L(h):h),g={},[b,...u]=l.split("+");u.forEach(h=>{switch(h.toLocaleLowerCase()){case"omitempty":g.omitEmpty=!0;break;default:console.warn(`unrecognized attribute binding directive: "${h}"`)}}),t.push(new rt(r,b,m,g))}}return t}function Se(){return document.createComment("")}function ht(i){return Array.isArray(i)||!!(i&&i[Symbol.iterator])}function R(i,...e){return new K(i,e)}var ke=`:host {
    --toolbar-border: 2px solid rgb(7 89 133);
    --toolbar-background-color: rgba(200, 200, 200, 0.4);
    --toolbar-button-color: rgb(2 132 199);
    --toolbar-button-color-selected: rgb(7 89 133);
    --toolbar-button-color-disabled: #7c7c7c;
    --toolbar-button-color-danger: #800000;

    position: relative;
    display: flex;
    align-items: stretch;
}

* {
    box-sizing: border-box;
}

.material-icons {
    vertical-align: middle;
}

canvas {
    flex-grow: 1;
}

.toolbar {
    min-width: 8rem;

    border-left: var(--toolbar-border);
    border-bottom: var(--toolbar-border);
    padding: 2px;

    display: flex;
    flex-direction: column;
    align-items: center;

    background-color: var(--toolbar-background-color);

    padding-top: 1rem;

    position: absolute;
    right: 0;
    top: 0;
    z-index: 10;
}

.toolbar > button {
    min-width: 6rem;
    margin-bottom: 4px;

    background-color: var(--toolbar-button-color);
    color: white;

    border: 1px solid var(--toolbar-button-color);
    border-radius: 4px;
}

.toolbar > button:disabled {
    border-color: var(--toolbar-button-color-disabled);
    background-color: var(--toolbar-button-color-disabled);
}

.toolbar > button.danger {
    background-color: var(--toolbar-button-color-danger);
    border-color: var(--toolbar-button-color-danger);
}
`,dt=`
.toolbar .divider {
    min-height: 1rem;
}

.toolbar .control {
    min-width: 6rem;
    margin-bottom: 4px;

    background-color: var(--toolbar-button-color);
    color: white;

    border: 1px solid var(--toolbar-button-color);
    border-radius: 4px;

    display: flex;
}

.toolbar > * {
    vertical-align: center;
}

.toolbar .control button {
    background-color: var(--toolbar-button-color);
    color: white;

    border: 0;
}

.toolbar .control select {
    background-color: var(--toolbar-button-color);
    color: white;

    border: 0;
}

.toolbar .control input[type="color"] {
    background-color: var(--toolbar-button-color);
    color: white;

    border: 0;                    
}

.toolbar .control.selected,
.toolbar .control.selected button,
.toolbar .control.selected select,
.toolbar .control.selected input {
    background-color: var(--toolbar-button-color-selected);
}

.toolbar > input[type="color"] {
    border: 1px solid var(--toolbar-button-color);
    border-radius: 4px;
    min-width: 6rem;
    margin-bottom: 4px;    
}

.toolbar .checkbox {
    min-width: 6rem;
    margin-bottom: 4px;
    display: flex;
    justify-content: space-between;
    color: var(--toolbar-button-color);
}

.toolbar > button.selected {
    background-color: var(--toolbar-button-color-selected);
}

`;be("battlemap-editor",(i,e)=>{var n,r,s,a;i.background=(n=i.background)!=null?n:[],i.explanations=(r=i.explanations)!=null?r:[],i.tokens=(s=i.tokens)!=null?s:[],i.action=(a=i.action)!=null?a:"move";const t=l=>{var m,g,b,u,h,S;const p=l.target;let c=N.forCanvas(p);c===null?c=N.create({canvas:p,scene:B(i),move:i.action==="move",select:i.action==="move",drawingMode:i.action==="zone"?"rect":i.action==="draw"?(m=i.drawingMode)!=null?m:"line":null,drawingStyle:v.create(i.action==="zone"?Y:_),grid:(g=i.showGrid)!=null?g:!1,viewport:(b=i.viewport)!=null?b:E.create({origin:5}),resize:!0,zoom:!0,selectionStyle:{strokeStyle:"#ffb600",lineWidth:2,lineDash:[2,2],shadowColor:"#ffb600",shadowBlur:5},gridSize:T}).on("sceneUpdated",d=>{Be(i,d.source.scene),e.emit(x,i)}).on("viewportChanged",d=>{i.viewport=d.source.viewport,e.emit(ue,i.viewport)}).on("selectionChanged",d=>{i.selectedIds=d.source.scene.selected.map(k=>k.id)}).on("drawingFinished",d=>{var k,se,oe;if(i.action==="zone")(se=i.explanations)==null||se.push(z.create({at:d.points[0],size:d.points[0].diff(d.points[1]),label:`Zone #${((k=i.explanations)==null?void 0:k.length)+1}`}));else if(i.action==="draw"){let H;if(typeof i.drawingMode=="undefined"||i.drawingMode==="line")H=d.points.map(Me=>Me.translate(-d.points[0].x,-d.points[0].y));else if(i.drawingMode==="rect")H=[0,[d.points[1].x-d.points[0].x,0],[d.points[1].x-d.points[0].x,d.points[1].y-d.points[0].y],[0,d.points[1].y-d.points[0].y],[0,0]];else throw new Error(`Unexpected drawing mode: '${i.drawingMode}'`);(oe=i.background)==null||oe.push(A.create({at:d.points[0],points:H}))}e.emit(x,i),e.requestUpdate()}):(c.scene=B(i),c.move=i.action==="move",c.select=i.action==="move",c.drawingMode=i.action==="zone"?"rect":i.action==="draw"?(u=i.drawingMode)!=null?u:"line":null,c.drawingStyle=v.create(i.action==="zone"?Y:_),c.grid=(h=i.showGrid)!=null?h:!1,c.viewport=(S=i.viewport)!=null?S:c.viewport)};return we(R`
            <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
            <style .innerText=${ke}></style>
            <style .innerText=${dt}></style>
            ${mt(i,e)}
            <canvas @update=${t}></canvas>
        `)});function ut(i,e){var t,n;(n=i.tokens)==null||n.push(I.create({at:[10,10],color:(t=i.tokenColor)!=null?t:J})),i.action="move",e.requestUpdate(),e.emit(x,i)}function ft(i,e){i.background=[],i.explanations=[],i.tokens=[],i.viewport=void 0,e.requestUpdate(),e.emit(x,i)}function pt(i,e){var t;!((t=i.selectedIds)==null?void 0:t.length)||(_e(i,...i.selectedIds),e.emit(x,i),e.requestUpdate())}function mt(i,e){var t,n,r;return R`
        <div class="toolbar">
            
            <button @click=${()=>{i.action="move",e.requestUpdate()}} class=${i.action==="move"?"selected":""}><i class="material-icons">pan_tool</i></button>
            <button @click=${pt.bind(null,i,e)}><i class="material-icons">delete</i></button>
            
            <div class="divider"></div>
            
            <div class="control ${i.action==="draw"?"selected":""}">
                <button @click=${()=>{i.action="draw",e.requestUpdate()}}><i class="material-icons">edit</i></button>
                <select @change=${s=>{i.drawingMode=s.target.value,e.requestUpdate()}}>
                    <option value="line">Line</option>
                    <option value="rect">Rect</option>
                </select>
            </div>
            
            <div class="divider"></div>
            
            <button @click=${()=>{i.action="zone",e.requestUpdate()}} class=${i.action==="zone"?"selected":""}><i class="material-icons">crop_free</i></button>
            
            <div class="divider"></div>

            <div class="control ${i.action==="token"?"selected":""}">
                <button @click=${ut.bind(null,i,e)} class=${i.action==="token"?"selected":""}><i class="material-icons">add_circle</i></button>
                <input type="color" value=${(t=i.tokenColor)!=null?t:J.toHex()} @change=${s=>{i.tokenColor=s.target.value}}>
            </div>
            
            <div class="divider"></div>
            
            <div class="checkbox">
                <input type="checkbox" .checked=${(n=i.showGrid)!=null?n:!1} @change=${s=>{i.showGrid=s.target.checked,i.grid=i.showGrid&&i.grid,e.emit(x,i),e.requestUpdate()}}>
                Grid
            </div>
            <div class="checkbox">
                <input type="checkbox" .checked=${(r=i.grid)!=null?r:!1} ?disabled=${!i.showGrid} @change=${s=>{i.grid=s.target.checked,e.emit(x,i),e.requestUpdate()}}>
                on Viewer
            </div>
            
            <div class="divider"></div>
            
            <button @click=${ft.bind(void 0,i,e)} class="danger"><i class="material-icons">close</i></button>

            <div class="divider"></div>
            
            <button @click=${gt.bind(void 0,i,e)}><i class="material-icons">${i.fullscreen?"fullscreen_exit":"fullscreen"}</i></button>
        </div>
    `}function gt(i,e,t){var n;i.fullscreen?(i.fullscreen=!1,document.exitFullscreen()):(i.fullscreen=!0,(n=t.target.getRootNode())==null||n.host.requestFullscreen()),e.requestUpdate()}be("battlemap-viewer",(i,e)=>{const t=n=>{var a,l,p,c;const r=n.target;let s=N.forCanvas(r);s===null?s=N.create({canvas:r,scene:B(i),viewport:(a=i.viewport)!=null?a:E.create({origin:[5,5]}),move:!0,select:!1,resize:!0,zoom:!0,grid:(l=i.grid)!=null?l:!1,gridSize:T}).on("viewportChanged",m=>{i.viewport=m.source.viewport,e.emit(ue,i.viewport)}):(s.scene=B(i),s.viewport=(p=i.viewport)!=null?p:s.viewport,s.grid=(c=i.grid)!=null?c:!1)};return we(R`
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <style .innerText=${ke}></style>
        ${bt(i,e)}
        <canvas @update=${t}></canvas>
    `)});function bt(i,e){return R`
        <div class="toolbar">           
            <button @click=${yt.bind(void 0,i,e)}><i class="material-icons">${i.fullscreen?"fullscreen_exit":"fullscreen"}</i></button>
        </div>
    `}function yt(i,e,t){var n;i.fullscreen?(i.fullscreen=!1,document.exitFullscreen()):(i.fullscreen=!0,(n=t.target.getRootNode())==null||n.host.requestFullscreen()),e.requestUpdate()}function wt(i){var e,t,n,r,s,a,l;return JSON.stringify({background:(t=(e=i.background)==null?void 0:e.map(re))!=null?t:[],explanations:(r=(n=i.explanations)==null?void 0:n.map(re))!=null?r:[],tokens:(a=(s=i.tokens)==null?void 0:s.map(re))!=null?a:[],grid:(l=i.grid)!=null?l:!1})}function vt(i){var t,n,r;const e=JSON.parse(i);return{background:((t=e.background)!=null?t:[]).map(ne),explanations:((n=e.explanations)!=null?n:[]).map(ne),tokens:((r=e.tokens)!=null?r:[]).map(ne),grid:e.grid}}function ne(i){var e,t,n,r;switch(i.type){case"drawing":return A.create({id:i.id,at:i.at,points:(e=i.points)!=null?e:[]});case"zone":return z.create({id:i.id,at:i.at,size:(t=i.size)!=null?t:[0,0],label:(n=i.label)!=null?n:""});case"token":return I.create({id:i.id,at:i.at,color:(r=i.color)!=null?r:"#000000"});default:throw new Error(`unexpected shape type: ${i.type}`)}}function re(i){if(i instanceof A)return{type:"drawing",id:i.id,at:[i.at.x,i.at.y],points:i.points.map(e=>[e.x,e.y])};if(i instanceof z)return{type:"zone",id:i.id,at:[i.at.x,i.at.y],size:[i.size.x,i.size.y],label:i.label};if(i instanceof I)return{type:"token",id:i.id,at:[i.at.x,i.at.y],color:i.color.toHex()};throw new Error(`Unexpected shape: ${i}`)}const Et=5e3;function xt(i){return typeof i.content!="undefined"}function Ne(i){var r;const e=xt(i)?i:{content:i};e.style=(r=e.style)!=null?r:"info";const t=document.body.appendChild(document.createElement("div"));q(t,C`
<div @update=${s=>{const a=s.target;a.addEventListener("transitionend",()=>{setTimeout(()=>{a.addEventListener("transitionend",()=>{document.body.removeChild(t)},{once:!0}),setTimeout(()=>a.style.opacity="0")},Et)},{once:!0}),setTimeout(()=>a.style.opacity="1")}} class="notification ${e.style}"> 
  <div class="px-4 py-2 -mx-3">
      <div class="mx-3">
          <p class="text-sm">${e.content}</p>
      </div>
  </div>
</div>    
    `)}document.addEventListener("DOMContentLoaded",()=>{let i,e;const t=n=>{const r=n.target;r.addEventListener(x,s=>{e.send(wt(s.detail))}),e.addEventListener("message",s=>{try{const a=vt(s.data);r.setData(a)}catch(a){console.error(a)}})};if(document.location.pathname.startsWith("/view/"))i=document.location.pathname.substring("/view/".length),e=new WebSocket(`ws${document.location.protocol.substring(4)}//${document.location.host}/ws/view/${i}`),q("#app",C`
            ${$e(i,!1)}
            <battlemap-viewer @update=${t}></battlemap-viewer>
        `);else if(document.location.pathname.startsWith("/edit/"))i=document.location.pathname.substring("/edit/".length),e=new WebSocket(`ws${document.location.protocol.substring(4)}//${document.location.host}/ws/edit/${i}`),q("#app",C`
            ${$e(i,!0)}
            <battlemap-editor @update=${t}></battlemap-editor>
        `);else{document.location.href=`/edit/${$t()}`;return}e.addEventListener("close",()=>{Ne("The editor closed the map.")})});function St(i,e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),navigator.clipboard.writeText(kt(i)),Ne("Url to join the map has been copied to your clipboard.")}function kt(i){return`${document.location.protocol}//${document.location.host}/view/${i}`}function $e(i,e){const t=e?C`        
        <button @click=${St.bind(null,i)}><i class="material-icons">share</i></button>
    `:"";return C`
        <div class="bg-sky-600 text-white p-4 shadow-md font-sans flex justify-between">
            <div class="grow-[1]">
                <span class="text-lg font-bold">Battle Map</span>
                ${i}
            </div>
            <div class="flex align-end">
                ${t}
            </div>
        </div>`}const Ce="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Nt=8;function $t(){let i="";for(let e=0;e<Nt;++e)i+=Ce.charAt(Math.random()*Ce.length);return i}
