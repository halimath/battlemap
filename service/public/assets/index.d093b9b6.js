var Ne=Object.defineProperty;var Ce=(i,e,t)=>e in i?Ne(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var s=(i,e,t)=>(Ce(i,typeof e!="symbol"?e+"":e,t),t);import{u as Me,h as F,a as $e}from"./vendor.e7d42eab.js";const De=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}};De();class y{constructor(e,t){s(this,"x");s(this,"y");this.x=e,this.y=t!=null?t:e}static create(e){return e instanceof y?e:Array.isArray(e)?new y(e[0],e.length>1?e[1]:e[0]):new y(e,e)}static fromOrigin(e){return new y(e.x,e.y)}get length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}diff(e){return new y(this.x/e,this.y/e)}toString(){return`|${this.x}, ${this.y}|`}}class u{constructor(e,t){s(this,"x");s(this,"y");this.x=e,this.y=t!=null?t:e}static get origin(){return new u(0,0)}static create(e){return e instanceof u?e:Array.isArray(e)?new u(e[0],e.length>1?e[1]:e[0]):new u(e,e)}static fromMouseEvent(e){return new u(e.offsetX,e.offsetY)}static fromTouchEvent(e){if(e.touches.length===0)throw new Error("empty touches");const t=e.target.getBoundingClientRect();return new u(e.touches[0].clientX-t.left,e.touches[0].clientY-t.top)}diff(e){return new y(e.x-this.x,e.y-this.y)}move(e){return this.translate(e.x,e.y)}translate(e,t){return new u(this.x+e,this.y+t)}isSame(e){return this.x===e.x&&this.y===e.y}toString(){return`(${this.x}, ${this.y})`}}const re=.1,Ae=.01,Oe=10;class E{constructor(e,t=1){s(this,"origin");s(this,"scale");this.origin=e,this.scale=t}static initial(){return new E(u.origin,1)}static create(e){var t;return new E(u.create(e.origin),(t=e.scale)!=null?t:1)}zoomOut(){return this.scale<=Ae?this:new E(this.origin,this.scale-re)}zoomIn(){return this.scale>=Oe?this:new E(this.origin,this.scale+re)}move(e){return new E(this.origin.move(e),this.scale)}applyTranspose(e){e.translate(this.origin.x,this.origin.y),e.scale(this.scale,this.scale)}toCoordinateSpace(e){return new u((e.x-this.origin.x)/this.scale,(e.y-this.origin.y)/this.scale)}}class b{constructor(e,t,n,r=1){s(this,"red");s(this,"green");s(this,"blue");s(this,"alpha");if(this.red=e,this.green=t,this.blue=n,this.alpha=r,e<0||e>1)throw new Error(`invalid red component: ${this.red}`);if(t<0||t>1)throw new Error(`invalid green component: ${this.green}`);if(n<0||n>1)throw new Error(`invalid blue component: ${this.blue}`);if(r<0||r>1)throw new Error(`invalid alpha component: ${this.alpha}`)}static fromRGBBytes(e,t,n,r=1){return new b(e/255,t/255,n/255,r)}static parseHex(e){if(e.charAt(0)!=="#")throw new Error(`Invalid color hex string: '${e}'`);let t=e.substring(1).split("");if(t.length===3&&(t=t.reduce((n,r)=>n.concat([r,r]),[])),t.length!==6)throw new Error(`Invalid color hex string: '${e}'`);return b.fromRGBBytes(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16))}lighten(e){return new b(Math.min(this.red+this.red*e,1),Math.min(this.green+this.green*e,1),Math.min(this.blue+this.blue*e,1),this.alpha)}darken(e){return new b(Math.max(this.red-this.red*e,0),Math.max(this.green-this.green*e,0),Math.max(this.blue-this.blue*e,0),this.alpha)}withAlpha(e){if(e<0||e>1)throw new Error(`invalid alpha component: ${this.alpha}`);return new b(this.red,this.green,this.blue,e)}toCSS(){return`rgba(${this.red*255}, ${this.green*255}, ${this.blue*255}, ${this.alpha})`}toHex(){return`#${U(this.red)}${U(this.green)}${U(this.blue)}`}toString(){return this.toCSS()}}function U(i){const e=(i*255).toString(16);return e.length<2?"0"+e:e}class w{constructor(e,t,n,r,a,o,c,h,p,m,g,d,l,v){s(this,"fillStyle");s(this,"strokeStyle");s(this,"lineWidth");s(this,"lineCap");s(this,"lineJoin");s(this,"shadowOffsetX");s(this,"shadowOffsetY");s(this,"shadowBlur");s(this,"shadowColor");s(this,"fontSize");s(this,"fontFamily");s(this,"textAlign");s(this,"direction");s(this,"lineDash");this.fillStyle=e,this.strokeStyle=t,this.lineWidth=n,this.lineCap=r,this.lineJoin=a,this.shadowOffsetX=c,this.shadowOffsetY=h,this.shadowBlur=p,this.shadowColor=m,this.fontSize=g,this.fontFamily=d,this.textAlign=l,this.direction=v,this.lineDash=typeof o=="number"?[o]:o}static create(e){var t,n,r,a,o,c,h,p,m,g,d,l,v,f;return e&&e instanceof w?e:new w((t=e==null?void 0:e.fillStyle)!=null?t:null,(n=e==null?void 0:e.strokeStyle)!=null?n:null,(r=e==null?void 0:e.lineWidth)!=null?r:null,(a=e==null?void 0:e.lineCap)!=null?a:null,(o=e==null?void 0:e.lineJoin)!=null?o:null,(c=e==null?void 0:e.lineDash)!=null?c:null,(h=e==null?void 0:e.shadowOffsetX)!=null?h:null,(p=e==null?void 0:e.shadowOffsetY)!=null?p:null,(m=e==null?void 0:e.shadowBlur)!=null?m:null,(g=e==null?void 0:e.shadowColor)!=null?g:null,(d=e==null?void 0:e.fontSize)!=null?d:null,(l=e==null?void 0:e.fontFamily)!=null?l:null,(v=e==null?void 0:e.textAlign)!=null?v:null,(f=e==null?void 0:e.direction)!=null?f:null)}prepare(e){var t,n;this.fillStyle!==null&&(e.fillStyle=se(this.fillStyle)),this.strokeStyle!==null&&(e.strokeStyle=se(this.strokeStyle)),this.lineWidth&&(e.lineWidth=this.lineWidth),this.lineDash!==null&&e.setLineDash(this.lineDash),this.lineCap&&(e.lineCap=this.lineCap),this.lineJoin&&(e.lineJoin=this.lineJoin),this.shadowOffsetX&&(e.shadowOffsetX=this.shadowOffsetX),this.shadowOffsetY&&(e.shadowOffsetY=this.shadowOffsetY),this.shadowBlur&&(e.shadowBlur=this.shadowBlur),this.shadowColor&&(e.shadowColor=this.shadowColor.toString()),(this.fontFamily||this.fontSize)&&(e.font=`${(t=this.fontSize)!=null?t:10}px ${(n=this.fontFamily)!=null?n:"sans-serif"}`),this.textAlign&&(e.textAlign=this.textAlign),this.direction&&(e.direction=this.direction)}apply(e){this.fillStyle&&e.fill(),this.strokeStyle&&e.stroke()}}function se(i){return i instanceof b?i.toCSS():i}class C{constructor(e,t,n){s(this,"path");s(this,"closed");s(this,"style");this.path=e,this.closed=t,this.style=n}static rectangle(e){const t=y.create(e.size),n={d:[0,[0,t.y],[t.x,t.y],[t.x,0]],closed:!0,style:e.style};return this.create(n)}static ellipse(e){var a,o,c;const t=y.create(e.size),n=new Path2D;n.ellipse(t.x/2,t.y/2,t.x/2,t.y/2,(a=e.rotation)!=null?a:0,(o=e.startAngle)!=null?o:0,(c=e.endAngle)!=null?c:2*Math.PI);const r={d:n,closed:!0,style:e.style};return this.create(r)}static create(e){var n;let t;if(Array.isArray(e.d)){t=new Path2D;const r=e.d.map(u.create);t.moveTo(r[0].x,r[0].y),r.slice(1).forEach(a=>{t.lineTo(a.x,a.y)}),e.closed&&t.closePath()}else typeof e.d=="string"?t=new Path2D(e.d):t=e.d;return new C(t,(n=e.closed)!=null?n:!1,w.create(e.style))}repaint(e){this.style.prepare(e),this.style.fillStyle&&e.fill(this.path),this.style.strokeStyle&&e.stroke(this.path)}}class R{constructor(e,t){s(this,"text");s(this,"style");this.text=e,this.style=t}static create(e){var t,n,r;return e.style=Object.assign({},(t=e.style)!=null?t:{}),e.style.fillStyle=(r=(n=e.style.fillStyle)!=null?n:e.style.strokeStyle)!=null?r:"black",new R(e.text,w.create(e.style))}repaint(e){this.style.prepare(e),this.style.fillStyle?e.fillText(this.text,0,0):e.strokeText(this.text,0,0)}}class M{constructor(e,t){s(this,"at");s(this,"p");this.at=e,this.p=t}static create(e){return e instanceof M?e:Array.isArray(e)?new M(u.create(e[0]),e[1]):new M(u.origin,e)}repaint(e){try{e.save(),e.translate(this.at.x,this.at.y),this.p.repaint(e)}finally{e.restore()}}}class ${constructor(e,t,n,r,a,o,c){s(this,"id");s(this,"at");s(this,"selectable");s(this,"movable");s(this,"selected");s(this,"outline");s(this,"paintables");this.id=e,this.at=t,this.selectable=n,this.movable=r,this.selected=a,this.outline=o,this.paintables=c}static create(e){var t,n,r;return Array.isArray(e.paintables)||(e.paintables=[e.paintables]),new $((t=e.id)!=null?t:T(),u.create(e.at),!!e.outline,(n=e.movable)!=null?n:!1,!1,(r=e.outline)!=null?r:null,e.paintables.map(M.create))}repaint(e,t){try{e.save(),e.translate(this.at.x,this.at.y),this.paintables.forEach(n=>n.repaint(e)),this.selected&&this.outline&&(t.prepare(e),e.stroke(this.outline))}finally{e.restore()}}contains(e,t){if(!this.outline)return!1;const n=t.translate(-this.at.x,-this.at.y);return e.isPointInPath(this.outline,n.x,n.y)}}class H{constructor(e,...t){s(this,"id");s(this,"elements");this.id=e,this.elements=t}repaint(e,t){this.elements.forEach(n=>{n.repaint(e,t)})}firstHit(e,t){for(let n=this.elements.length-1;n>=0;n--)if(this.elements[n].selectable&&this.elements[n].contains(e,t))return this.elements[n];return null}get selected(){return this.elements.filter(e=>e.selected)}unselectAll(){this.elements.forEach(e=>e.selected=!1)}findElement(e){var t;return(t=this.elements.find(n=>n.id===e))!=null?t:null}}class ze{constructor(...e){s(this,"layers");this.layers=e}findElement(e){for(const t of this.layers){const n=t.findElement(e);if(n!==null)return n}return null}findLayer(e){var t;return(t=this.layers.find(n=>n.id===e))!=null?t:null}repaint(e,t){this.layers.forEach(n=>n.repaint(e,t))}firstHit(e,t){for(let n=this.layers.length-1;n>=0;n--){const r=this.layers[n].firstHit(e,t);if(r!==null)return r}return null}get selected(){return this.layers.reduce((e,t)=>e.concat(t.selected),[])}unselectAll(){this.layers.forEach(e=>e.unselectAll())}}const ae="abcdefghijklmnopqrstuvwxyz_-$",Te=16;function T(){let i="";for(let e=0;e<Te;++e)i+=ae.charAt(Math.random()*ae.length);return i}class Le{constructor(){s(this,"listener",new Map)}on(e,t){var n;return this.listener.has(e)?((n=this.listener.get(e))==null||n.push(t),this):(this.listener.set(e,[t]),this)}emit(e,t){var n;return(n=this.listener.get(e))==null||n.forEach(r=>r(t)),this}}class S{constructor(e,t,n,r,a,o,c,h,p,m,g,d,l){s(this,"canvas");s(this,"_scene");s(this,"resize");s(this,"zoom");s(this,"select");s(this,"move");s(this,"drawingMode");s(this,"selectionStyle");s(this,"drawingStyle");s(this,"_grid");s(this,"_gridStyle");s(this,"_viewport");s(this,"_backgroundStyle",w.create({fillStyle:b.fromRGBBytes(200,200,200)}));s(this,"_gridSize");s(this,"eventEmitter",new Le);s(this,"drawingPath",null);s(this,"drawnPoints",null);s(this,"onResize",()=>{!this.resize||this.repaint()});s(this,"interactOrigin",null);s(this,"interactLastCheckpoint",null);s(this,"onPointerDown",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.canvas.setPointerCapture(e.pointerId),this.onInteractStart(u.fromMouseEvent(e))});s(this,"onPointerUp",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.onInteractEnd(u.fromMouseEvent(e),e.ctrlKey)});s(this,"onInteractEnd",(e,t)=>{var n;if(this.interactOrigin!==null)try{this.drawingMode!==null&&this.finishDraw(e),this.select&&(((n=this.interactOrigin)==null?void 0:n.isSame(e))?this.handleSelection(e,t):this.scene.selected.length>0&&this.emit({eventName:"sceneUpdated",source:this}))}finally{this.interactLastCheckpoint=null,this.interactOrigin=null}});s(this,"onPointerMove",e=>{!this.interactLastCheckpoint||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.canvas.setPointerCapture(e.pointerId),this.onInteractMove(u.fromMouseEvent(e)))});s(this,"onInteractMove",e=>{const t=this.interactLastCheckpoint.diff(e);if(this.interactLastCheckpoint=e,this.drawingMode!==null){this.handleDraw(e);return}if(!this.move)return;const n=this.scene.selected;if(n.length>0){n.forEach(r=>r.at=r.at.move(t.diff(this.viewport.scale))),this.repaint();return}this.viewport=this.viewport.move(t),this.repaint(),this.emit({eventName:"viewportChanged",source:this})});s(this,"onZoom",e=>{!this.zoom||this.drawingMode!==null||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.deltaY>0?this.viewport=this.viewport.zoomOut():this.viewport=this.viewport.zoomIn(),this.emit({eventName:"viewportChanged",source:this}),this.repaint())});this.canvas=e,this._scene=t,this.resize=n,this.zoom=r,this.select=a,this.move=o,this.drawingMode=c,this.selectionStyle=h,this.drawingStyle=p,this._grid=m,this._gridStyle=d,this._viewport=l!=null?l:E.initial(),this._gridSize=y.create(g)}static forCanvas(e){var t;return(t=oe(e)._scenic)!=null?t:null}static create(e){var r,a,o,c,h,p,m,g,d,l;const t=oe(e.canvas),n=new S(t,e.scene,(r=e.resize)!=null?r:!1,(a=e.zoom)!=null?a:!1,(o=e.select)!=null?o:!1,(c=e.move)!=null?c:!1,(h=e.drawingMode)!=null?h:null,w.create((p=e.selectionStyle)!=null?p:{strokeStyle:"#0069dba0",lineWidth:2,shadowColor:"#0083ff",shadowBlur:5}),w.create((m=e.drawingStyle)!=null?m:{strokeStyle:"#0069dba0",lineWidth:2,lineDash:[15,5],shadowColor:"#0083ff",shadowBlur:5}),(g=e.grid)!=null?g:!1,(d=e.gridSize)!=null?d:10,w.create((l=e.gridStyle)!=null?l:{strokeStyle:b.fromRGBBytes(150,150,150),lineWidth:1}),e.viewport);return t._scenic&&t._scenic.disconnect(),t._scenic=n,n.connect(),n.repaint(),n}get viewport(){return this._viewport}set viewport(e){this._viewport=e,this.repaint()}get scene(){return this._scene}set scene(e){this._scene=e,this.repaint()}get backgroundStyle(){return this._backgroundStyle}set backgroundStyle(e){this._backgroundStyle=e,this.repaint()}get grid(){return this._grid}set grid(e){this._grid=e,this.repaint()}get gridSize(){return this._gridSize}set gridSize(e){this._gridSize=y.create(e),this.repaint()}get gridStyle(){return this._gridStyle}set gridStyle(e){this._gridStyle=e,this.repaint()}on(e,t){return this.eventEmitter.on(e,t),this}repaint(){requestAnimationFrame(()=>{this.canvas.width=this.canvas.scrollWidth,this.canvas.height=this.canvas.scrollHeight;const e=this.canvas.getContext("2d");if(e.clearRect(0,0,this.canvas.width,this.canvas.height),this._backgroundStyle.prepare(e),e.fillRect(0,0,this.canvas.width,this.canvas.height),this.grid)try{e.save(),this._gridStyle.prepare(e);let t=this._viewport.origin.x%(this._gridSize.x*this._viewport.scale);for(;t<this.canvas.width;)t>0&&(e.moveTo(t,0),e.lineTo(t,this.canvas.height),e.stroke()),t+=this._gridSize.x*this._viewport.scale;let n=this._viewport.origin.y%(this._gridSize.y*this._viewport.scale);for(;n<this.canvas.width;)n>0&&(e.moveTo(0,n),e.lineTo(this.canvas.width,n),e.stroke()),n+=this._gridSize.y*this._viewport.scale}finally{e.restore()}try{e.save(),this.viewport.applyTranspose(e),this.scene.repaint(e,this.selectionStyle)}finally{e.restore()}if(this.drawingPath!==null)try{e.save(),this.drawingStyle.prepare(e),this.drawingStyle.fillStyle&&e.fill(this.drawingPath),this.drawingStyle.strokeStyle&&e.stroke(this.drawingPath)}finally{e.restore()}})}emit(e){this.eventEmitter.emit(e.eventName,e)}connect(){window.addEventListener("resize",this.onResize),this.canvas.addEventListener("wheel",this.onZoom),this.canvas.addEventListener("pointerdown",this.onPointerDown),this.canvas.addEventListener("pointerup",this.onPointerUp),this.canvas.addEventListener("pointermove",this.onPointerMove)}disconnect(){window.removeEventListener("resize",this.onResize),this.canvas.removeEventListener("wheel",this.onZoom),this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.canvas.removeEventListener("pointerup",this.onPointerUp),this.canvas.removeEventListener("pointermove",this.onPointerMove)}onInteractStart(e){this.interactOrigin=e,this.interactLastCheckpoint=this.interactOrigin}handleDraw(e){this.updateDrawingPath(e),this.repaint()}finishDraw(e){this.drawnPoints.push(this.viewport.toCoordinateSpace(e)),this.emit({eventName:"drawingFinished",source:this,mode:this.drawingMode,points:this.drawnPoints}),this.repaint(),this.drawingPath=null,this.drawnPoints=null}updateDrawingPath(e){if(this.drawingMode==="rect"){const t=this.interactOrigin.diff(e);this.drawingPath=new Path2D,this.drawingPath.rect(this.interactOrigin.x,this.interactOrigin.y,t.x,t.y),this.drawnPoints===null&&(this.drawnPoints=[this.viewport.toCoordinateSpace(e)])}else this.drawingMode==="poly"&&(this.drawingPath===null?(this.drawingPath=new Path2D,this.drawingPath.moveTo(this.interactOrigin.x,this.interactOrigin.y),this.drawnPoints=[this.viewport.toCoordinateSpace(e)]):this.drawnPoints.push(this.viewport.toCoordinateSpace(e)),this.drawingPath.lineTo(e.x,e.y))}handleSelection(e,t){e=this.viewport.toCoordinateSpace(e);const n=this.canvas.getContext("2d"),r=this.scene.firstHit(n,e);r===null?this.scene.unselectAll():(t&&this.scene.unselectAll(),r.selected=!r.selected),this.repaint(),this.emit({eventName:"selectionChanged",source:this})}}function oe(i){if(typeof i!="string")return i;const e=document.querySelector(i);if(e===null)throw new Error(`No such canvas element: ${i}`);if(!(e instanceof HTMLCanvasElement))throw new Error(`Not a canvas element: ${e}`);return e}const le=b.fromRGBBytes(10,10,10),j={strokeStyle:le,lineJoin:"round",lineWidth:5,shadowColor:le,shadowBlur:5},Pe=b.fromRGBBytes(2,132,199),ce={strokeStyle:Pe,lineWidth:5,lineJoin:"round",lineDash:[15,5],fontFamily:"verdana, helvetica, arial, sans-serif",fontSize:20},q=b.parseHex("#b91c1c"),Ie={lineWidth:5,shadowColor:"#666",shadowBlur:5,shadowOffsetX:5,shadowOffsetY:5};function Be(i){let e;return typeof i=="string"?e=b.parseHex(i):e=i,_e({strokeStyle:e,fillStyle:e.lighten(.5).withAlpha(.5)},Ie)}function _e(i,e){return Object.assign({},i,e)}const L=50;class D{constructor(e,t,n,r){s(this,"id");s(this,"at");s(this,"points");s(this,"style");this.id=e,this.at=t,this.points=n,this.style=r}static create(e){var t,n;return new D((t=e.id)!=null?t:T(),u.create(e.at),e.points.map(u.create),(n=e.style)!=null?n:j)}createSceneElement(){return $.create({id:this.id,at:this.at,paintables:C.create({d:this.points,style:j})})}}class A{constructor(e,t,n,r,a){s(this,"id");s(this,"at");s(this,"size");s(this,"label");s(this,"style");this.id=e,this.at=t,this.size=n,this.label=r,this.style=a}static create(e){var t,n,r;return new A((t=e.id)!=null?t:T(),u.create(e.at),y.create(e.size),(n=e.label)!=null?n:"Zone",(r=e.style)!=null?r:ce)}createSceneElement(){return $.create({id:this.id,at:this.at,paintables:[C.rectangle({size:this.size,closed:!0,style:this.style}),[[10,25],R.create({text:this.label,style:this.style})]]})}}class O{constructor(e,t,n,r){s(this,"id");s(this,"at");s(this,"style");s(this,"color");this.id=e,this.at=t,this.style=n,this.color=r}static create(e){var n,r;let t=q;return e.color&&(typeof e.color=="string"?t=b.parseHex(e.color):t=e.color),new O((n=e.id)!=null?n:T(),u.create(e.at),(r=e.style)!=null?r:Be(t),t)}createSceneElement(){const e=new Path2D;return e.rect(-10,-10,L+10,L+10),$.create({id:this.id,at:this.at,outline:e,movable:!0,paintables:C.ellipse({size:L-10,closed:!0,style:this.style})})}}function he(i,e){return typeof i!="string"?i:(e||(e=document.body),e.querySelector(i))}function P(i){J(i.firstChild)}function J(i,e){for(;i&&i!==e;){let t=i;i=i.nextSibling,t.parentNode.removeChild(t)}}function We(i){return typeof i=="function"||Array.isArray(i)||i instanceof Element||de(i)}function I(i,e,t){t=t!=null?t:!0;const n=typeof i=="string"?he(i):i;Re(n,e),t&&Fe(n)}function Fe(i){const e=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,new Ue);let t;for(;t=e.nextNode();)t.dispatchEvent(new CustomEvent("update",{bubbles:!1}))}class Ue{acceptNode(e){return e.nodeType===Node.ELEMENT_NODE&&e.nodeName.indexOf("-")>=0?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}function Re(i,e){if(Array.isArray(e)){P(i),e.forEach(t=>{const n=document.createDocumentFragment();I(n,t),i.appendChild(n)});return}if(typeof e=="string"){P(i),i.appendChild(document.createTextNode(e));return}if(e instanceof Element){P(i),i.appendChild(e);return}if(de(e)){e.updateElement(i);return}e(i)}function de(i){return typeof i=="object"&&"updateElement"in i}class ue extends HTMLElement{constructor(){super(...arguments);this.data={},this.connected=!1,this.renderContext=new He(this),this.updateRequested=!1,this.executedOnceCallbackIds=new Set,this.requestUpdate=()=>{if(!this.updateRequested)return this.updateRequested=!0,setTimeout(this.executeUpdate.bind(this),1),this},this.emit=(e,t)=>{const n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!0});return this.dispatchEvent(n),this}}setData(e){return e&&Object.keys(e).forEach(t=>this.data[t]=e[t]),this.connected&&this.requestUpdate(),this}mount(e){return he(e).appendChild(this),this}connectedCallback(){Array.prototype.forEach.call(this.attributes,e=>{this.observedAttributes.indexOf(e.name)!==-1&&(this.data[e.name]=e.value)}),this.connected=!0,this.updateDom()}disconnectedCallback(){this.childNodes.forEach(this.removeChild.bind(this)),this.connected=!1}attributeChangedCallback(e,t,n){const r={};r[je(e)]=n,this.setData(r)}registerOnceCallback(e,t){this.executedOnceCallbackIds.has(e)||(this.executedOnceCallbackIds.add(e),Promise.resolve().then(()=>{t()}))}executeUpdate(){!this.updateRequested||Promise.resolve().then(()=>{const e=this.observedAttributes;Object.keys(this.data).forEach(t=>{e.indexOf(t)>-1&&this.setAttribute(pe(t),this.data[t])}),this.updateDom()})}updateDom(){const e=this.renderCallback(this.data||{},this.renderContext);this.updateRequested=!1,I(this,e)}}class He{constructor(e){this.component=e}requestUpdate(){return this.component.requestUpdate(),this}emit(e,t){return this.component.emit(e,t),this}addEventListener(e,t){return this.component.addEventListener(e,t),this}once(e,t){return this.component.registerOnceCallback(e,t),this}}function fe(i,e,...t){const n=t.map(a=>Array.isArray(a)?a:[a]).reduce((a,o)=>a.concat(o),[]),r=n.map(a=>pe(a));return window.customElements.define(i,class extends ue{constructor(){super(...arguments);this.renderCallback=e,this.observedAttributes=n}static get observedAttributes(){return r}}),qe.bind(null,i)}function pe(i){let e="",t=!1;for(let n of i)n.toUpperCase()===n?(t&&(e+="-"),e+=n.toLowerCase(),t=!0):(e+=n,t=!1);return e}function je(i){let e="",t=!1;for(let n of i)n==="-"?t=!0:t?(e+=n.toUpperCase(),t=!1):e+=n;return e}function qe(i,e,t){const n=document.createElement(i);if(!(n instanceof ue)){console.error("Element is not a defined Weco element:",n);return}return n.setData(e),typeof t!="undefined"&&t!==null&&n.mount(t),n}function me(i){return e=>{const t=e.shadowRoot||e.attachShadow({mode:"open"});typeof i=="function"?i.call(null,t):I(t.getRootNode(),i,!0)}}const ge="{{wecco:",Je="}}",be=/(\{\{wecco:\d+\}\})/;function Xe(i){return i.split(be).filter(e=>e.length>0)}function x(i){return!!i.match(be)}function z(i){return parseInt(i.substr(ge.length))}function ye(i){return ge+i.toString()+Je}const X=new WeakMap;class G{constructor(e,t){this.strings=e,this.data=t}get templateString(){return typeof this._templateString=="undefined"&&(this._templateString=Ke(this.strings)),this._templateString}get templateElement(){return typeof this._templateElement=="undefined"&&(this._templateElement=document.createElement("template"),this._templateElement.innerHTML=this.templateString,this._bindings=nt(this._templateElement.content)),this._templateElement}get bindings(){return typeof this._bindings=="undefined"?[]:this._bindings}updateElement(e){if(X.has(e)){const t=X.get(e);if(t.strings===this.strings){t.data=this.data,V(t.bindings,this.data);return}}P(e),e.appendChild(this.templateElement.content.cloneNode(!0)),it(this.bindings,e),V(this.bindings,this.data),X.set(e,this)}}const Ge=/[a-z0-9-_@]+\s*=\s*$/i,Ye=/[a-z0-9-_@]+\s*=\s*'[^']*$/i,Ze=/[a-z0-9-_@]+\s*=\s*"[^"]*$/i;function Ke(i){let e="";return i.forEach((t,n)=>{e+=t,n<i.length-1&&(Ge.test(e)||Ye.test(e)||Ze.test(e)?e+=ye(n):e+=`<!--${ye(n)}-->`)}),e.trim()}const B="DOM inconsistency error";class Y{constructor(e){this.nodeIndex=e}bind(e,t){t===this.nodeIndex&&this.bindNode(e)}bindNode(e){this.node=e}}class Z extends Y{constructor(e,t){super(e);this.dataIndex=t}applyData(e){const t=e[this.dataIndex];this.boundData!==t&&(this.applyChangedData(t),this.boundData=t)}}class K extends Y{constructor(e,t){super(e);this.dataIndex=t}bindNode(e){super.bindNode(e),e.data="",this.endMarker=e,this.startMarker=e.parentNode.insertBefore(we(),e)}applyData(e){const t=e[this.dataIndex];this.boundData!==t&&(typeof t=="string"?this.applyText(t):rt(t)?this.applyIterable(t):We(t)?this.applyElementUpdate(t):this.applyText(String(t)))}applyIterable(e){const t=Array.from(e);if(Array.isArray(this.boundData)){const n=this.boundData;t.length<n.length?(J(n[t.length].startMarker,this.endMarker),this.boundData=n.slice(0,t.length)):t.length>n.length&&this.createBindingsFromIterable(t,n.length)}else this.clear(),this.boundData=[],this.createBindingsFromIterable(t);this.boundData.forEach(n=>n.applyData(t))}createBindingsFromIterable(e,t=0){for(let n=t;n<e.length;++n){const r=this.endMarker.parentNode.insertBefore(we(),this.endMarker),a=new K(this.nodeIndex,n);a.bind(r,this.nodeIndex),this.boundData.push(a)}}applyElementUpdate(e){if(e instanceof G&&this.boundData instanceof G&&e.templateString===this.boundData.templateString){this.boundData.data=e.data,V(this.boundData.bindings,e.data);return}this.clear();const t=document.createDocumentFragment();I(t,e,!1),this.endMarker.parentNode.insertBefore(t,this.endMarker),this.boundData=e}applyText(e){if(this.endMarker.previousSibling.nodeType===Node.TEXT_NODE){this.endMarker.previousSibling.data=e,this.boundData=e;return}this.clear(),this.node=this.endMarker.parentNode.insertBefore(document.createTextNode(e),this.endMarker),this.boundData=e}clear(){var e;const t=this.startMarker?this.startMarker.nextSibling:this.node.parentNode.firstChild;J(t,(e=this.endMarker)!==null&&e!==void 0?e:this.node)}}class Ve extends Y{constructor(e,t,n,r){super(e);this.attributeName=t,this.valueInstructions=n,this.directives=r}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.attributeName} but got ${e}`),B;this.element=e,super.bindNode(e)}applyData(e){let t=!1;const n=this.valueInstructions.map(r=>{if(typeof r=="string")return r;let a=e[r];return(typeof a=="undefined"||a===null)&&(t=!0),a}).join("");if(t&&this.directives.omitEmpty){this.element.removeAttribute(this.attributeName),this.boundAttributeValue=void 0;return}n!==this.boundAttributeValue&&(this.element.setAttribute(this.attributeName,n),this.boundAttributeValue=n)}}class Qe extends Z{constructor(e,t,n){super(e,n);this.attributeName=t}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.attributeName} but got ${e}`),B;this.element=e,super.bindNode(e)}applyChangedData(e){e?this.element.setAttribute(this.attributeName,this.attributeName):this.element.removeAttribute(this.attributeName)}}class et extends Z{constructor(e,t,n,r){super(e,n);this.eventName=t,this.directives=r}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set attribute ${this.eventName} but got ${e}`),B;this.element=e,super.bindNode(e)}applyChangedData(e){this.boundListener&&this.element.removeEventListener(this.eventName,this.boundListener),this.boundListener=this.createListener(e),this.element.addEventListener(this.eventName,this.boundListener,this.directives)}createListener(e){return!this.directives.stopPropagation&&!this.directives.stopImmediatePropagation&&!this.directives.preventDefault?e:t=>{this.directives.stopPropagation&&t.stopPropagation(),this.directives.stopImmediatePropagation&&t.stopImmediatePropagation(),this.directives.preventDefault&&t.preventDefault(),"handleEvent"in e?e.handleEvent(t):e(t)}}}class tt extends Z{constructor(e,t,n){super(e,n);this.propertyName=t}bindNode(e){if(e.nodeType!==Node.ELEMENT_NODE)throw console.error(`Expected element to set property ${this.propertyName} but got ${e}`),B;this.element=e,super.bindNode(e)}applyChangedData(e){this.element[this.propertyName]=e}}function V(i,e){i.forEach(t=>t.applyData(e))}function it(i,e){const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null);let n=-1,r;for(;r=t.nextNode();)n++,i.forEach(a=>a.bind(r,n))}function nt(i){const e=[],t=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null);let n=-1,r;for(;r=t.nextNode();)if(n++,r.nodeType===Node.COMMENT_NODE){const a=r;x(a.data)&&e.push(new K(n,z(a.data)))}else if(r.nodeType===Node.ELEMENT_NODE){const a=r;for(let o of a.getAttributeNames()){const c=a.getAttribute(o),h=Xe(c);if(o.startsWith("?")){if(a.removeAttribute(o),h.length!==1||!x(h[0])){console.error(`Got syntax error using boolean attribute ${o}: Only single placeholder is allowed as value. Found at ${a}.`);continue}e.push(new Qe(n,o.substr(1),z(h[0])));continue}if(o.startsWith(".")){if(a.removeAttribute(o),h.length!==1||!x(h[0])){console.error(`Got syntax error using property ${o}: Only single placeholder is allowed as value. Found at ${a}.`);continue}e.push(new tt(n,o.substr(1),z(h[0])));continue}if(o.startsWith("@")){if(a.removeAttribute(o),h.length!==1||!x(h[0])){console.error(`Got syntax error using event listener ${o}: Only single placeholder is allowed as value. Found at ${a}.`);continue}const l={},[v,...f]=o.substr(1).split("+");f.forEach(N=>{switch(N.toLocaleLowerCase()){case"capture":l.capture=!0;break;case"passive":l.passive=!0;break;case"once":l.once=!0;break;case"stoppropagation":l.stopPropagation=!0;break;case"stopimmediatepropagation":l.stopImmediatePropagation=!0;break;case"preventdefault":l.preventDefault=!0;break;default:console.warn(`unrecognized event binding directive: "${N}"`)}}),e.push(new et(n,v,z(h[0]),l));continue}if(h.length===1&&!x(h[0]))continue;a.removeAttribute(o);const p=h.map(l=>x(l)?z(l):l),m={},[g,...d]=o.split("+");d.forEach(l=>{switch(l.toLocaleLowerCase()){case"omitempty":m.omitEmpty=!0;break;default:console.warn(`unrecognized attribute binding directive: "${l}"`)}}),e.push(new Ve(n,g,p,m))}}return e}function we(){return document.createComment("")}function rt(i){return Array.isArray(i)||!!(i&&i[Symbol.iterator])}function Q(i,...e){return new G(i,e)}function st(i,e){at(i).forEach(t=>{var n,r;t.at=(r=(n=e.findElement(t.id))==null?void 0:n.at)!=null?r:t.at})}function at(i){var t,n,r;let e=(t=i.background)!=null?t:[];return e=e.concat((n=i.explanations)!=null?n:[]),e=e.concat((r=i.tokens)!=null?r:[]),e}function _(i){var e,t,n,r,a,o;return new ze(new H("background",...(t=(e=i.background)==null?void 0:e.map(c=>c.createSceneElement()))!=null?t:[]),new H("explanations",...(r=(n=i.explanations)==null?void 0:n.map(c=>c.createSceneElement()))!=null?r:[]),new H("tokens",...(o=(a=i.tokens)==null?void 0:a.map(c=>c.createSceneElement()))!=null?o:[]))}var ot=`:host {
    --toolbar-border: 2px solid #333;
    --toolbar-button-color: rgb(2 132 199);
    --toolbar-button-color-selected: rgb(7 89 133);
    --toolbar-button-color-disabled: #7c7c7c;

    display: flex;
    align-items: stretch;
}

* {
    box-sizing: border-box;
}

.material-icons {
    vertical-align: middle;
}

.toolbar {
    min-width: 8rem;

    border-right: var(--toolbar-border);
    padding: 2px;

    display: flex;
    flex-direction: column;
    align-items: center;

    background-color: #eaeaea;
}

.toolbar  .divider {
    min-height: 1rem;
}

.toolbar  button {
    min-width: 6rem;
    margin-bottom: 4px;

    background-color: var(--toolbar-button-color);
    color: white;

    border: 1px solid var(--toolbar-button-color);
    border-radius: 4px;
}

.toolbar input[type="color"] {
    border: 1px solid var(--toolbar-button-color);
    border-radius: 4px;
    min-width: 6rem;
    margin-bottom: 4px;    
}

.toolbar .checkbox {
    min-width: 6rem;
    margin-bottom: 4px;
    display: flex;
    justify-content: space-between;
    color: var(--toolbar-button-color);
}

.toolbar  button.selected {
    background-color: var(--toolbar-button-color-selected);
}

.toolbar  button:disabled {
    border-color: var(--toolbar-button-color-disabled);
    background-color: var(--toolbar-button-color-disabled);
}

canvas {
    flex-grow: 4;
} `;const W="battlemapUpdated",lt=fe("battlemap-editor",(i,e)=>{var r,a,o,c,h,p;i.background=(r=i.background)!=null?r:[],i.explanations=(a=i.explanations)!=null?a:[],i.tokens=(o=i.tokens)!=null?o:[],i.action=(c=i.action)!=null?c:"move",i.grid=(h=i.grid)!=null?h:!1,i.viewport=(p=i.viewport)!=null?p:E.create({origin:[5,5]});const t=m=>{var l,v;const g=m.target;let d=S.forCanvas(g);d===null&&(d=S.create({canvas:g,scene:_(i),resize:!0,zoom:!0,selectionStyle:{strokeStyle:"#0069dba0",lineWidth:2,lineDash:[2,2],shadowColor:"#0083ff",shadowBlur:5},gridSize:L}).on("sceneUpdated",f=>{st(i,f.source.scene),e.emit(W,i)}).on("viewportChanged",f=>{i.viewport=f.source.viewport}).on("drawingFinished",f=>{var N,ie,ne;i.action==="zone"?(ie=i.explanations)==null||ie.push(A.create({at:f.points[0],size:f.points[0].diff(f.points[1]),label:`Zone #${((N=i.explanations)==null?void 0:N.length)+1}`})):i.action==="draw"&&((ne=i.background)==null||ne.push(D.create({at:f.points[0],points:f.points.map(ke=>ke.translate(-f.points[0].x,-f.points[0].y))}))),e.emit(W,i),e.requestUpdate()})),d.scene=_(i),d.move=i.action==="move",d.select=i.action==="move",d.drawingMode=i.action==="zone"?"rect":i.action==="draw"?"poly":null,d.drawingStyle=w.create(i.action==="zone"?ce:j),d.grid=(l=i.grid)!=null?l:!1,d.viewport=(v=i.viewport)!=null?v:d.viewport},n=document.createElement("style");return n.textContent=ot,me([n,Q`
            <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
            ${ht(i,e)}
            <canvas @update=${t}></canvas>
        `])});function ct(i,e){var t,n;(n=i.tokens)==null||n.push(O.create({at:[10,10],color:(t=i.tokenColor)!=null?t:q})),i.action="move",e.emit(W,i),e.requestUpdate()}function ht(i,e){var t,n;return Q`
        <div class="toolbar">
            
            <button @click=${()=>{i.action="move",e.requestUpdate()}} class=${i.action==="move"?"selected":""}><i class="material-icons">pan_tool</i></button>
            <div class="divider"></div>
            <button @click=${()=>{i.action="draw",e.requestUpdate()}} class=${i.action==="draw"?"selected":""}><i class="material-icons">edit</i></button>
            <div class="divider"></div>
            <button @click=${()=>{i.action="zone",e.requestUpdate()}} class=${i.action==="zone"?"selected":""}><i class="material-icons">crop_free</i></button>
            <div class="divider"></div>
            <input type="color" value=${(t=i.tokenColor)!=null?t:q.toHex()} @change=${r=>{i.tokenColor=r.target.value}}>
            <button @click=${ct.bind(null,i,e)} class=${i.action==="token"?"selected":""}><i class="material-icons">add_circle</i></button>
            <button @click=${()=>{i.action="remove",e.requestUpdate()}} disabled class=${i.action==="remove"?"selected":""}><i class="material-icons">remove_circle</i></button>
            <div class="divider"></div>
            <div class="checkbox">
                <input type="checkbox" ?checked=${(n=i.grid)!=null?n:!1} @change=${r=>{i.grid=r.target.checked,e.requestUpdate()}}>
                Grid
            </div>
            <div class="divider"></div>
            <button @click=${()=>{i.background=[],i.explanations=[],i.tokens=[],i.viewport=void 0,e.requestUpdate()}}><i class="material-icons">delete</i></button>
        </div>
    `}const dt=fe("battlemap-viewer",i=>me(Q`
        <style>           
            :host {           
                display: flex;
                align-items: stretch;
            }

            canvas {
                flex-grow: 4;
            }
        </style>
        <canvas @update=${t=>{var a;const n=t.target;let r=S.forCanvas(n);r===null&&(r=S.create({canvas:n,scene:_(i),move:!0,select:!1,resize:!0,zoom:!0}).on("viewportChanged",o=>{i.viewport=o.source.viewport})),r.scene=_(i),r.viewport=(a=i.viewport)!=null?a:E.create({origin:[5,5]})}}></canvas>
    `));function ut(i){var e,t,n,r,a,o;return JSON.stringify({background:(t=(e=i.background)==null?void 0:e.map(te))!=null?t:[],explanations:(r=(n=i.explanations)==null?void 0:n.map(te))!=null?r:[],tokens:(o=(a=i.tokens)==null?void 0:a.map(te))!=null?o:[]})}function ft(i){const e=JSON.parse(i);return{background:e.background.map(ee),explanations:e.explanations.map(ee),tokens:e.tokens.map(ee)}}function ee(i){var e,t,n,r;switch(i.type){case"drawing":return D.create({id:i.id,at:i.at,points:(e=i.points)!=null?e:[]});case"zone":return A.create({id:i.id,at:i.at,size:(t=i.size)!=null?t:[0,0],label:(n=i.label)!=null?n:""});case"token":return O.create({id:i.id,at:i.at,color:(r=i.color)!=null?r:"#000000"});default:throw new Error(`unexpected shape type: ${i.type}`)}}function te(i){if(i instanceof D)return{type:"drawing",id:i.id,at:[i.at.x,i.at.y],points:i.points.map(e=>[e.x,e.y])};if(i instanceof A)return{type:"zone",id:i.id,at:[i.at.x,i.at.y],size:[i.size.x,i.size.y],label:i.label};if(i instanceof O)return{type:"token",id:i.id,at:[i.at.x,i.at.y],color:i.color.toHex()};throw new Error(`Unexpected shape: ${i}`)}const pt=5e3;function mt(i){return typeof i.content!="undefined"}function ve(i){var r;const e=mt(i)?i:{content:i};e.style=(r=e.style)!=null?r:"info";const t=document.body.appendChild(document.createElement("div"));Me(t,F`
<div @update=${a=>{const o=a.target;o.addEventListener("transitionend",()=>{setTimeout(()=>{o.addEventListener("transitionend",()=>{document.body.removeChild(t)},{once:!0}),setTimeout(()=>o.style.opacity="0")},pt)},{once:!0}),setTimeout(()=>o.style.opacity="1")}} class="notification ${e.style}"> 
  <div class="px-4 py-2 -mx-3">
      <div class="mx-3">
          <p class="text-sm">${e.content}</p>
      </div>
  </div>
</div>    
    `)}class k{constructor(e,t,n,r){this.view=e,this.id=t,this.battleMap=n,this.ws=r}static editor(){const e=bt();return new k("editor",e,{},new WebSocket(`ws${document.location.protocol.substring(4)}//${document.location.host}/edit/${e}`))}static join(e){return new k("viewer",e,{},new WebSocket(`ws${document.location.protocol.substring(4)}//${document.location.host}/view/${e}`))}get shareUrl(){return`${document.location.protocol}//${document.location.host}/join/${this.id}`}}const Ee="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",gt=8;function bt(){let i="";for(let e=0;e<gt;++e)i+=Ee.charAt(Math.random()*Ee.length);return i}class Se{constructor(e){s(this,"command","battleMap-updated");this.battleMap=e}}class yt{constructor(e){s(this,"command","join");this.id=e}}function wt(i,e,t){switch(e.command){case"battleMap-updated":return Et(new k(i.view,i.id,e.battleMap,i.ws));case"join":return vt(e.id,t)}}function vt(i,e){const t=k.join(i);return t.ws.addEventListener("message",n=>{try{e.emit(new Se(ft(n.data)))}catch(r){console.error(r)}}),t.ws.addEventListener("close",()=>{ve("The editor closed the map.")}),t}function Et(i){return i.ws.send(ut(i.battleMap)),i}function St(i,e){if(i.view==="viewer")return[xe(i),dt(i.battleMap)];const t=lt(i.battleMap);return t.addEventListener(W,n=>{e.emit(new Se(n.detail))}),[xe(i),t]}function xt(i,e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),navigator.clipboard.writeText(i.shareUrl),ve("Url to join the map has been copied to your clipboard.")}function xe(i){const e=i.view==="editor"?F`        
        <button @click=${xt.bind(null,i)}><i class="material-icons">share</i></button>
    `:"";return F`
        <div class="bg-sky-600 text-white p-4 mb-1 shadow-md font-sans flex justify-between">
            <div class="grow-[1]">
                <span class="text-lg font-bold">Battle Map</span>
                <a href="${i.shareUrl}">${i.id}</span>

            </div>
            <div class="flex align-end">
                ${e}
            </div>
        </div>`}document.addEventListener("DOMContentLoaded",()=>{const i=$e(k.editor,wt,St,"#app");document.location.pathname.startsWith("/join/")&&i.emit(new yt(document.location.pathname.substring("/join/".length)))});
